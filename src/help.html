<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      My Listings
    </title>
    <!-- Import SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </head>
  <script type="module">
    // Import Firebase modules
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
    import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyB-8sarU_q2gdfBSLQAUhNlnbmj3T2o8nA",
        authDomain: "ryntit-b503c.firebaseapp.com",
        databaseURL: "https://ryntit-b503c-default-rtdb.firebaseio.com",
        projectId: "ryntit-b503c",
        storageBucket: "ryntit-b503c.appspot.com",
        messagingSenderId: "908115066071",
        appId: "1:908115066071:web:1de252c17cce4346be0492",
        measurementId: "G-PDBZNLKYKC"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Check authentication state
    onAuthStateChanged(auth, async (user) => {
        if (user) {
            console.log("User is signed in:", user.uid);

            // Fetch data from Firestore
            const userCollection = collection(db, "users");
            const userQuery = query(userCollection, where("uid", "==", user.uid));
            const querySnapshot = await getDocs(userQuery);

            querySnapshot.forEach((doc) => {
                console.log(`${doc.id} =>`, doc.data());
            });
        } else {
            console.log("No user is signed in.");
            window.location.href = 'signin.html'; // Redirect to your login page
        }
    });
  </script>

  <body
    x-data="{ page: 'ecommerce', 'loaded': true, 'darkMode': true, 'stickyMenu': false, 'sidebarToggle': false, 'scrollTop': false }"
    x-init="
      darkMode = JSON.parse(localStorage.getItem('darkMode'));
      $watch('darkMode', value => localStorage.setItem('darkMode', JSON.stringify(value)))"
    :class="{'dark text-bodydark bg-boxdark-2': darkMode === true}"
  >
    <!-- ===== Preloader Start ===== -->
    <include src="./partials/preloader.html"></include>
    <!-- ===== Preloader End ===== -->

    <!-- ===== Page Wrapper Start ===== -->
    <div class="flex h-screen overflow-hidden">
      <!-- ===== Sidebar Start ===== -->
      <include src="./partials/sidebar.html"></include>
      <!-- ===== Sidebar End ===== -->

      <!-- ===== Content Area Start ===== -->
      <div class="relative flex flex-1 flex-col overflow-y-auto overflow-x-hidden">
        <!-- ===== Header Start ===== -->
        <include src="./partials/header.html" />
        <!-- ===== Header End ===== -->

        <!-- ===== Main Content Start ===== -->
        <main>
          <div class="mx-auto max-w-screen-2xl p-4 md:p-6 2xl:p-10">
            <div class="flex flex-col gap-9">
              <!-- Blurb Section -->
              <div class="bg-blue-50 p-4 rounded-md shadow-md dark:bg-secondary dark:text-white">
                <p class="text-lg font-semibold">
                  Need further assistance? Reach out to us here and we will get back to you ASAP!
                </p>
              </div>

              <!-- Contact Form -->
              <div class="rounded-sm border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark">
                <div class="border-b border-stroke px-6.5 py-4 dark:border-strokedark">
                  <h3 class="font-medium text-black dark:text-white">Contact Form</h3>
                </div>
                <form action="#" onsubmit="validateForm(event)">
                  <div class="p-6.5">
                    <div class="mb-4.5">
                      <label class="mb-3 block text-sm font-medium text-black dark:text-white">
                        Subject
                      </label>
                      <div x-data="{ isOptionSelected: false }" class="relative z-20 bg-transparent dark:bg-form-input">
                        <select
                          id="subject"
                          class="relative z-20 w-full appearance-none rounded border border-stroke bg-transparent px-5 py-3 outline-none transition focus:border-primary active:border-primary dark:border-strokedark dark:bg-form-input dark:focus:border-primary"
                          :class="isOptionSelected && 'text-black dark:text-white'"
                          @change="isOptionSelected = true"
                        >
                          <option value="" class="text-body">Select your subject</option>
                          <option value="Order Issues" class="text-body">Order Issues</option>
                          <option value="Account Problem" class="text-body">Account Problem</option>
                          <option value="Other" class="text-body">Other</option>
                        </select>
                        <span class="absolute right-4 top-1/2 z-30 -translate-y-1/2">
                          <svg class="fill-current" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g opacity="0.8">
                              <path fill-rule="evenodd" clip-rule="evenodd" d="M5.29289 8.29289C5.68342 7.90237 6.31658 7.90237 6.70711 8.29289L12 13.5858L17.2929 8.29289C17.6834 7.90237 18.3166 7.90237 18.7071 8.29289C19.0976 8.68342 19.0976 9.31658 18.7071 9.70711L12.7071 15.7071C12.3166 16.0976 11.6834 16.0976 11.2929 15.7071L5.29289 9.70711C4.90237 9.31658 4.90237 8.68342 5.29289 8.29289Z" fill=""></path>
                            </g>
                          </svg>
                        </span>
                      </div>
                    </div>

                    <div class="mb-6">
                      <label class="mb-3 block text-sm font-medium text-black dark:text-white">Message</label>
                      <textarea
                        id="message"
                        rows="6"
                        placeholder="Type your message"
                        class="w-full rounded border-[1.5px] border-stroke bg-transparent px-5 py-3 font-normal text-black outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary"
                      ></textarea>
                    </div>

                    <button type="submit" class="flex w-full justify-center rounded bg-primary p-3 font-medium text-gray hover:bg-opacity-90">
                      Send Message
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>
  </body>
  <script>
    // Import your sendEmailToBackend function
    async function sendEmailToBackend(subject, message) {
      const response = await fetch('/api/send-email', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ subject, message }),
      });

      const data = await response.json();
      if (data.message === 'Email sent!') {
        Swal.fire('Success', 'Your message has been sent!', 'success');
      } else {
        Swal.fire('Error', 'There was a problem sending your message.', 'error');
      }
    }

    // Form validation and SweetAlert
    function validateForm(event) {
      event.preventDefault(); // Prevent form submission

      const subject = document.getElementById('subject').value;
      const message = document.getElementById('message').value;

      if (!subject || !message) {
        Swal.fire({
          icon: 'error',
          title: 'Oops...',
          text: 'Please fill out both Subject and Message fields!',
          confirmButtonText: 'Got it!',
          customClass: {
            confirmButton: 'custom-ok-button'
          }
        });
      } else {
        sendEmailToBackend(subject, message);
      }
    }
  </script>
    <style>
  /* Define the custom button style */
.custom-ok-button {
  background-color: #292929;  /* Green background */
  color: white;  /* Text color */
  border: none;  /* Remove border */
  padding: 10px 20px;  /* Add padding */
  font-size: 16px;  /* Adjust font size */
  border-radius: 5px;  /* Round the corners */
}

/* Hover effect for the button */
.custom-ok-button:hover {
  background-color: #000000;  /* Darker green on hover */
}

  </style>
</html>
